"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[8439],{369:(e,t,i)=>{i.d(t,{xA:()=>p,yg:()=>u});var n=i(7378);function a(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function r(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function o(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?r(Object(i),!0).forEach((function(t){a(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):r(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function l(e,t){if(null==e)return{};var i,n,a=function(e,t){if(null==e)return{};var i,n,a={},r=Object.keys(e);for(n=0;n<r.length;n++)i=r[n],t.indexOf(i)>=0||(a[i]=e[i]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)i=r[n],t.indexOf(i)>=0||Object.prototype.propertyIsEnumerable.call(e,i)&&(a[i]=e[i])}return a}var s=n.createContext({}),m=function(e){var t=n.useContext(s),i=t;return e&&(i="function"==typeof e?e(t):o(o({},t),e)),i},p=function(e){var t=m(e.components);return n.createElement(s.Provider,{value:t},e.children)},d="mdxType",y={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var i=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=m(i),c=a,u=d["".concat(s,".").concat(c)]||d[c]||y[c]||r;return i?n.createElement(u,o(o({ref:t},p),{},{components:i})):n.createElement(u,o({ref:t},p))}));function u(e,t){var i=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=i.length,o=new Array(r);o[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:a,o[1]=l;for(var m=2;m<r;m++)o[m]=i[m];return n.createElement.apply(null,o)}return n.createElement.apply(null,i)}c.displayName="MDXCreateElement"},5787:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>y,frontMatter:()=>r,metadata:()=>l,toc:()=>m});var n=i(8084),a=(i(7378),i(369));const r={sidebar_position:5},o="Documents & Entities",l={unversionedId:"local-storage/entities",id:"local-storage/entities",title:"Documents & Entities",description:"Queries return Documents. A Document provides a .get method to retrieve properties, and a .set to set them - as well as other utility methods depending on its type. All root documents are Object Entities, which also provide .update. Since Documents can contain arbitrary sub-objects, you can retrieve lists off them, which comes as List Entities and provide some common list methods too.",source:"@site/docs/local-storage/entities.md",sourceDirName:"local-storage",slug:"/local-storage/entities",permalink:"/docs/local-storage/entities",draft:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"Indexes & Querying",permalink:"/docs/local-storage/querying"},next:{title:"Undo, Redo, and Batching",permalink:"/docs/local-storage/undo"}},s={},m=[{value:"Types of entities",id:"types-of-entities",level:2},{value:"Object methods and properties",id:"object-methods-and-properties",level:3},{value:"List methods and properties",id:"list-methods-and-properties",level:3},{value:"Primary key",id:"primary-key",level:2}],p={toc:m},d="wrapper";function y(e){let{components:t,...i}=e;return(0,a.yg)(d,(0,n.A)({},p,i,{components:t,mdxType:"MDXLayout"}),(0,a.yg)("h1",{id:"documents--entities"},"Documents & Entities"),(0,a.yg)("p",null,"Queries return Documents. A Document provides a ",(0,a.yg)("inlineCode",{parentName:"p"},".get")," method to retrieve properties, and a ",(0,a.yg)("inlineCode",{parentName:"p"},".set")," to set them - as well as other utility methods depending on its type. All root documents are Object Entities, which also provide ",(0,a.yg)("inlineCode",{parentName:"p"},".update"),". Since Documents can contain arbitrary sub-objects, you can retrieve lists off them, which comes as List Entities and provide some common list methods too."),(0,a.yg)("p",null,"These methods are, of course, typed based on the shape of your schema definitions!"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-ts"},"oneDoneItem.set('done', false);\n\nanItemWithAnArrayField.get('arrayField').push('foo');\n")),(0,a.yg)("p",null,"These will immediately update the in-memory document across all its subscribers (Entities are also cached by identity). The change will propagate to storage and sync asynchronously. When the change is stored, the document will update and drop the in-memory changes."),(0,a.yg)("h2",{id:"types-of-entities"},"Types of entities"),(0,a.yg)("p",null,"Entities currently have two shapes: ",(0,a.yg)("inlineCode",{parentName:"p"},"Object")," and ",(0,a.yg)("inlineCode",{parentName:"p"},"List"),". ",(0,a.yg)("inlineCode",{parentName:"p"},"Object")," covers the ",(0,a.yg)("inlineCode",{parentName:"p"},"object")," and ",(0,a.yg)("inlineCode",{parentName:"p"},"map")," field types and the root document. ",(0,a.yg)("inlineCode",{parentName:"p"},"List")," covers ",(0,a.yg)("inlineCode",{parentName:"p"},"array")," field types. ",(0,a.yg)("inlineCode",{parentName:"p"},"List")," entities can also be used as rudimentary Sets."),(0,a.yg)("p",null,"Each entity type exposes different fully-typed methods:"),(0,a.yg)("h3",{id:"object-methods-and-properties"},"Object methods and properties"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"keys()"),": Returns a list of all keys, like ",(0,a.yg)("inlineCode",{parentName:"li"},"Object.keys"),"."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"entries()"),": Returns ",(0,a.yg)("inlineCode",{parentName:"li"},"[key,value]")," pairs, like ",(0,a.yg)("inlineCode",{parentName:"li"},"Object.entries"),"."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"values()"),": Returns a list of all values, like ",(0,a.yg)("inlineCode",{parentName:"li"},"Object.values"),"."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"set(key, value)"),": Sets a specific value on the entity."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"delete(key)"),": Deletes a value by key from the entity. Only works for ",(0,a.yg)("inlineCode",{parentName:"li"},"nullable")," properties or on ",(0,a.yg)("inlineCode",{parentName:"li"},"map")," type entities."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"update(partial, { replaceSubObjects, merge })"),": Applies a partial object value on the entity. Allows a few options for advanced usage:",(0,a.yg)("ul",{parentName:"li"},(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"replaceSubObjects"),": Defaults ",(0,a.yg)("inlineCode",{parentName:"li"},"false"),", use ",(0,a.yg)("inlineCode",{parentName:"li"},"true")," to replace sub-objects by identity instead of trying to keep sub-object identity stable. Passing ",(0,a.yg)("inlineCode",{parentName:"li"},"true")," means if any other peer is editing a sub-object, the changes made by this ",(0,a.yg)("inlineCode",{parentName:"li"},"update")," will completely replace it, ignoring their changes. Use with care."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"merge"),": Defaults ",(0,a.yg)("inlineCode",{parentName:"li"},"true"),", use ",(0,a.yg)("inlineCode",{parentName:"li"},"false")," to cause omitted keys to erase their properties. Only works if omitted keys are optional in the schema, or on ",(0,a.yg)("inlineCode",{parentName:"li"},"map")," type fields. Otherwise this will throw a runtime error.")))),(0,a.yg)("h3",{id:"list-methods-and-properties"},"List methods and properties"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"length"),": Returns the length of the list, like ",(0,a.yg)("inlineCode",{parentName:"li"},"Array.length"),"."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"push(item)"),": Pushes an item onto the list. Push conflicts are resolved by intent; i.e. if two pushes are concurrent both items will be added in chronological order to the end of the list."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"insert(index, item)"),": Inserts an item at index, moving later items down. Insert conflicts are resolved by intent; i.e. if an insert is concurrent to some other change in the list, Verdant will still try to place the item at the index specified."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"move(from, to)"),": Moves an item from one index to another, moving other items to make room for it at the destination. Move conflicts are resolved by intent; multiple moves will be applied in chronological order using whatever items are at the specified ",(0,a.yg)("inlineCode",{parentName:"li"},"from")," index at time of resolution. For a more stable move when the ",(0,a.yg)("inlineCode",{parentName:"li"},"from")," item's identity is important, use ",(0,a.yg)("inlineCode",{parentName:"li"},"moveItem"),"."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"moveItem(item, to)"),": Moves the first instance of one particular item (by identity) to an index. ",(0,a.yg)("strong",{parentName:"li"},"If the items in this list are objects, you must pass a reference to an object retrieved from this entity, like one from ",(0,a.yg)("inlineCode",{parentName:"strong"},"get()")),". Item move conflicts are resolved by intent, meaning even if the target item has moved from its original position during concurrent edits, the item will still be found and moved to the desired position. If the item is not found, nothing happens, and no error is thrown."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"add(item)"),": A Set add method. Only pushes the item to the end of the list if it does not already exist in the list (by identity). Add conflicts are resolved by intent, meaning if two adds are concurrent, the add will not insert the item twice."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"removeAll(item)"),": A Set remove method. Removes all instances of an item (by identity) from the list."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"has(item)"),": A Set has method. Returns true if an item exists in the list (by identity)."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"removeFirst(item)"),": Removes only the first instance of an item (by identity). Remove first conflicts are resolved by intent, meaning if changes are resolved between peers and a new instance of the item is found earlier in the list than when this method was called on a client, that earlier item will be removed. This only really applies to primitive lists, since by definition a list of objects can't hold two objects of the same identity."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"removeLast(item)"),": Like ",(0,a.yg)("inlineCode",{parentName:"li"},"removeFirst"),", but from the opposite end."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"map(callback)"),": Does not modify the list. Lets you map over the items in the list and transform them. Returns a new JS ",(0,a.yg)("inlineCode",{parentName:"li"},"Array")," with the mapped items (not a new List entity). Similar to ",(0,a.yg)("inlineCode",{parentName:"li"},"Array.map"),"."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"filter(callback)"),": Does not modify the list. Lets you filter items to a subset. Returns a new JS ",(0,a.yg)("inlineCode",{parentName:"li"},"Array")," with the filtered items (not a new List entity). Similar to ",(0,a.yg)("inlineCode",{parentName:"li"},"Array.filter"),"."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"delete(index)"),": Deletes an item from the list by index. The item at the index is removed, and other items shift to 'fill the space.' Similar to ",(0,a.yg)("inlineCode",{parentName:"li"},"Array.splice(index, 1)"),"."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"forEach(callback)"),": Invokes the callback with each item in the list. Similar to ",(0,a.yg)("inlineCode",{parentName:"li"},"Array.forEach"),"."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"some(callback)"),": Returns ",(0,a.yg)("inlineCode",{parentName:"li"},"true")," if any item in the list passes the predicate (the callback returns ",(0,a.yg)("inlineCode",{parentName:"li"},"true"),"). Similar to ",(0,a.yg)("inlineCode",{parentName:"li"},"Array.some"),"."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"every(callback)"),": Returns ",(0,a.yg)("inlineCode",{parentName:"li"},"true")," if every item in the list passes the predicate (the callback returns ",(0,a.yg)("inlineCode",{parentName:"li"},"true"),"). Similar to ",(0,a.yg)("inlineCode",{parentName:"li"},"Array.every"),"."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"find(callback)"),": Returns the first item in the list that passes the predicate (the callback returns ",(0,a.yg)("inlineCode",{parentName:"li"},"true"),"). Similar to ",(0,a.yg)("inlineCode",{parentName:"li"},"Array.find"),"."),(0,a.yg)("li",{parentName:"ul"},(0,a.yg)("inlineCode",{parentName:"li"},"includes(item)"),": Alias of ",(0,a.yg)("inlineCode",{parentName:"li"},"has"),", to align with ",(0,a.yg)("inlineCode",{parentName:"li"},"Array.includes"),".")),(0,a.yg)("p",null,"Additionally, List entities implement ",(0,a.yg)("inlineCode",{parentName:"p"},"Iterable"),", so you can use them in ",(0,a.yg)("inlineCode",{parentName:"p"},"for...of")," loops."),(0,a.yg)("h2",{id:"primary-key"},"Primary key"),(0,a.yg)("p",null,"Every document has a primary key, which identifies it throughout the Verdant system. This primary key cannot be changed. Right now the types on documents will accept the primary key in a ",(0,a.yg)("inlineCode",{parentName:"p"},".set")," or ",(0,a.yg)("inlineCode",{parentName:"p"},".update"),", but will throw an error at runtime if it's used. In the future hopefully I'll update the types to make this constraint easier to catch while coding."))}y.isMDXComponent=!0}}]);